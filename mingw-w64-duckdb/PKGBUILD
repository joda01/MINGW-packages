# Maintainer: Alexey Pavlov <alexpux@gmail.com>

_realname=duckdb
pkgbase=mingw-w64-${_realname}
pkgname="${MINGW_PACKAGE_PREFIX}-${_realname}"
pkgver=0.10.2
_tag=v0.10.2
pkgrel=1
pkgdesc="A fast in-process analytical database"
arch=(any)
mingw_arch=('mingw32' 'mingw64' 'ucrt64' 'clang64' 'clang32' 'clangarm64')
url="https://duckdb.org/"
license=('MIT')
depends=()
makedepends=("${MINGW_PACKAGE_PREFIX}-cmake"
             "${MINGW_PACKAGE_PREFIX}-ninja")
source=("https://github.com/duckdb/duckdb/archive/refs/tags/${_tag}.tar.gz")
noextract=("${_tag}.tar.xz")
sha256sums=('662a0ba5c35d678ab6870db8f65ffa1c72e6096ad525a35b41b275139684cea6')

prepare() {
  tar -xf "${pkgver}.tar.gz" || true
}


build() {
  cd "${srcdir}/${_tag}.tar.gz"
  cmake -G "Ninja" -DCMAKE_BUILD_TYPE=Release -DBUILD_EXTENSIONS=parquet -DOVERRIDE_GIT_DESCRIBE="$OVERRIDE_GIT_DESCRIBE"
  cmake --build . --config Release
}

package() {
  cp "${srcdir}/${_realname}-${pkgver}/src/libduckdb.dll" "${pkgdir}${MINGW_PREFIX}/bin"
}


#
#package() {
#  cd "${srcdir}/build-${MSYSTEM}"
#
#  DESTDIR="${pkgdir}" "${MINGW_PREFIX}"/bin/cmake.exe --install .
#
#  install -Dm644 "${srcdir}/${_realname}-${_tag}/LICENSE" "${pkgdir}${MINGW_PREFIX}/share/licenses/${_realname}/LICENSE"
#}

#
#
https://github.com/duckdb/duckdb/archive/refs/tags/v0.10.2.tar.gz
https://github.com/duckdb/duckdb/releases/tag/v0.10.2